# SQL编辑器用户手册

## 目录
1. [快速开始](#快速开始)
2. [界面介绍](#界面介绍)
3. [基本操作](#基本操作)
4. [核心功能](#核心功能)
5. [高级功能](#高级功能)
6. [快捷键参考](#快捷键参考)
7. [常见问题](#常见问题)
8. [使用技巧](#使用技巧)

## 快速开始

### 安装和启动

#### 方法一：Python命令行启动
```bash
# 进入项目目录
cd sapfront-tools

# 安装依赖
pip install -r requirements.txt

# 启动程序
python main.py
```

#### 方法二：Windows批处理启动
双击 `start_sql_formatter.bat` 文件即可启动程序。

### 首次使用
1. 启动程序后，您将看到一个带有行号的代码编辑器
2. 可以直接在编辑器中输入SQL代码
3. 使用菜单栏中的各种功能来处理您的代码

## 界面介绍

### 主窗口布局
```
┌─────────────────────────────────────────────────────────────┐
│ 文件(F)  编辑(E)  工具(T)  帮助(H)                            │ ← 菜单栏
├─────────────────────────────────────────────────────────────┤
│ ┌─────────┐┌─────────┐┌─────────┐                    [×]     │ ← 标签页栏
│ │ users.sql││ query.sql││ 未命名 *│                           │
│ └─────────┘└─────────┘└─────────┘                           │
├─────────────────────────────────────────────────────────────┤
│ ┌───┐ ┌─────────────────────────────────────────────────┐   │
│ │ 1 │ │ SELECT * FROM users                             │   │
│ │ 2 │ │ WHERE id = ?                                    │   │ ← 编辑区域
│ │ 3 │ │ AND status = 'active'                           │   │
│ │...│ │                                                 │   │
│ └───┘ └─────────────────────────────────────────────────┘   │
│       ↑                                                     │
│    行号区域                                                  │
└─────────────────────────────────────────────────────────────┘
```

### 菜单栏功能
- **文件**: 打开、保存、退出等文件操作
- **编辑**: 撤销、重做、查找替换等编辑功能
- **工具**: SQL格式化、代码转换等核心功能
- **帮助**: 关于信息和版本信息

### 编辑器特性
- **多标签页**: 支持同时打开多个文件，每个文件在独立标签页中
- **行号显示**: 左侧显示行号，便于定位代码
- **语法高亮**: SQL关键字、字符串、注释自动高亮
- **深色主题**: 护眼的深色编辑界面
- **等宽字体**: 使用Consolas字体，代码对齐美观

### 标签页功能
- **新建标签页**: 点击菜单"文件→新建"或按Ctrl+N
- **打开文件**: 文件会在新标签页中打开
- **关闭标签页**: 点击标签页上的×按钮或按Ctrl+W
- **拖拽排序**: 可以拖拽标签页改变顺序
- **修改标识**: 未保存的文件标签页显示*标记
- **按钮新建**: 点击标签栏右侧的+按钮快速创建新标签页

## 基本操作

### 文件操作

#### 新建文件
1. **菜单方式**: 点击菜单 `文件` → `新建` 或按 `Ctrl+N`
2. **按钮方式**: 点击标签栏右侧的 `+` 按钮
3. 系统会创建一个新的标签页，标题显示为"未命名"
4. 开始编辑后标签页会显示*标记表示未保存

#### +按钮特性
- **位置**: 位于标签栏的右侧角落
- **样式**: 深色主题的圆形按钮，鼠标悬停时高亮
- **提示**: 鼠标悬停时显示"新建标签页 (Ctrl+N)"
- **快捷**: 一键创建新标签页，无需使用菜单

#### 打开文件
1. 点击菜单 `文件` → `打开` 或按 `Ctrl+O`
2. 选择要打开的SQL文件
3. 文件会在新的标签页中打开
4. 程序会自动检测文件编码并正确显示

#### 保存文件
1. **保存当前标签页**: `文件` → `保存` 或按 `Ctrl+S`
2. **另存为新文件**: `文件` → `另存为` 或按 `Ctrl+Shift+S`
3. 支持UTF-8编码保存，确保中文字符正确显示
4. 保存后标签页的*标记会消失

#### 关闭标签页
1. **关闭当前标签页**: `文件` → `关闭标签页` 或按 `Ctrl+W`
2. **点击关闭按钮**: 点击标签页右侧的×按钮
3. 如果文件有未保存的更改，会提示是否保存
4. 如果只剩一个标签页，关闭后会自动创建新的空标签页

### 编辑操作

#### 撤销和重做
- **撤销**: `编辑` → `撤销` 或按 `Ctrl+Z`
- **重做**: `编辑` → `重做` 或按 `Ctrl+Y`
- 支持多步撤销，可以回退到任意历史状态

#### 文本选择和复制
- 使用鼠标拖拽选择文本
- `Ctrl+A` 全选
- `Ctrl+C` 复制，`Ctrl+V` 粘贴
- `Ctrl+X` 剪切

#### 缩进操作
- **增加缩进**: 选中多行文本后按 `Tab` 键，每行前面会添加4个空格
- **减少缩进**: 选中多行文本后按 `Shift+Tab` 键，每行前面会删除最多4个空格
- 支持批量缩进调整，方便代码格式化

#### 大小写转换
- **转换为大写**: 选中文本后按 `Ctrl+Shift+U`，将选中的文本转换为大写
- **转换为小写**: 选中文本后按 `Ctrl+Shift+L`，将选中的文本转换为小写
- 适用于SQL关键字、变量名等的快速转换

## 核心功能

### 1. SQL格式化

#### 功能说明
将杂乱的SQL代码格式化为规范、美观的形式。

#### 使用方法
1. 在编辑器中输入或粘贴SQL代码
2. 点击 `工具` → `格式化SQL` 或按 `Ctrl+F`
3. SQL代码将自动格式化

#### 格式化效果
**格式化前:**
```sql
select id,name,email from users where status='active' and created_date>='2023-01-01'
```

**格式化后:**
```sql
SELECT id,
       name,
       email
FROM users
WHERE status = 'active'
  AND created_date >= '2023-01-01'
```

#### 格式化特性
- 关键字自动大写
- 智能缩进和换行
- 操作符周围添加空格
- 逗号前置格式
- 去除多余空白

### 2. Java代码转换

#### SQL转Java格式
将SQL语句转换为Java StringBuffer拼接代码。

**使用方法:**
1. 在编辑器中输入SQL代码
2. 点击 `工具` → `转换Java格式` 或按 `Ctrl+J`

**转换示例:**
```sql
-- 原始SQL
SELECT * FROM users 
WHERE id = ?
```

```java
// 转换后的Java代码
StringBuffer sb = new StringBuffer();
sb.append(" SELECT * FROM users ");
sb.append(" WHERE id = ? ");
```

#### Java转SQL格式
从Java StringBuffer代码中提取原始SQL。

**使用方法:**
1. 在编辑器中粘贴Java StringBuffer代码
2. 点击 `工具` → `从Java转回SQL` 或按 `Ctrl+K`

### 3. 参数填充

#### 功能说明
将SQL中的`?`占位符替换为实际参数值。

#### 使用方法
1. 在编辑器中输入包含`?`占位符的SQL
2. 点击 `工具` → `填充参数` 或按 `Ctrl+P`
3. 在弹出对话框中输入参数值（逗号分隔）
4. 点击确定完成替换

#### 使用示例
**原始SQL:**
```sql
SELECT * FROM users WHERE id = ? AND status = ?
```

**输入参数:** `123, active`

**填充后:**
```sql
SELECT * FROM users WHERE id = '123' AND status = 'active'
```

#### 注意事项
- 参数数量必须与占位符数量匹配
- 参数会自动添加单引号
- 支持数字、字符串等各种类型参数

### 4. 注释对齐

#### 功能说明
智能对齐Java代码中的注释，使代码更加整洁。

#### 使用方法
1. 在编辑器中输入包含注释的Java代码
2. 点击 `工具` → `对齐注释` 或按 `Ctrl+L`

#### 对齐示例
**对齐前:**
```java
String name = "张三";	// 用户姓名
int age = 25;		// 用户年龄
boolean isActive = true;	// 是否激活
```

**对齐后:**
```java
String name = "张三";        // 用户姓名
int age = 25;               // 用户年龄
boolean isActive = true;    // 是否激活
```

#### 对齐特性
- 自动将Tab转换为4个空格
- 智能计算最佳对齐位置
- 支持单行注释(//)
- 保持代码结构不变

### 5. 代码模板填充

#### 功能说明
使用自定义模板批量生成代码，提高开发效率。

#### 使用方法
1. 在编辑器中输入数据（Tab分隔）
2. 点击 `工具` → `代码填充` 或按 `Ctrl+M`
3. 在弹出对话框中输入模板
4. 点击确定生成代码

#### 模板语法
使用`{0}`, `{1}`, `{2}`等作为占位符，对应Tab分隔的数据列。

#### 使用示例
**输入数据:**
```
id	name	email
1	张三	zhangsan@example.com
2	李四	lisi@example.com
```

**模板:**
```java
User user{0} = new User();
user{0}.setId({0});
user{0}.setName("{1}");
user{0}.setEmail("{2}");
```

**生成结果:**
```java
User user1 = new User();
user1.setId(1);
user1.setName("张三");
user1.setEmail("zhangsan@example.com");

User user2 = new User();
user2.setId(2);
user2.setName("李四");
user2.setEmail("lisi@example.com");
```

## 高级功能

### 查找和替换

#### 打开查找替换对话框
点击 `编辑` → `查找替换` 或按 `Ctrl+H`

#### 基本查找
1. 在"查找内容"框中输入要查找的文本
2. 点击"查找下一个"或"查找上一个"
3. 匹配的文本会自动高亮显示

#### 高级选项
- **使用正则表达式**: 支持复杂的模式匹配
- **区分大小写**: 精确匹配大小写
- **实时高亮**: 自动高亮所有匹配项

#### 替换操作
1. 在"替换为"框中输入替换文本
2. 点击"替换"替换当前匹配项
3. 点击"全部替换"批量替换所有匹配项

#### 正则表达式示例
- `\d+`: 匹配数字
- `[a-zA-Z]+`: 匹配字母
- `\w+@\w+\.\w+`: 匹配邮箱格式
- `SELECT.*FROM`: 匹配SELECT到FROM的语句

### 显示空白字符

#### 功能说明
显示空白字符功能可以让您看到代码中的空格和Tab字符，帮助检查代码格式和缩进问题。

#### 使用方法
1. 点击菜单 `编辑` → `显示空格和Tab`
2. 选中后，编辑器中会显示空白字符的可视化标识
3. 再次点击可以关闭显示

#### 显示效果
- **空格**: 显示为小点 `·`
- **Tab**: 显示为箭头 `→`
- **换行**: 显示为换行符号

#### 使用场景
- **代码格式检查**: 检查缩进是否使用了Tab还是空格
- **格式化验证**: 验证SQL格式化后的缩进是否正确
- **混合缩进检测**: 发现代码中Tab和空格混用的问题
- **尾随空格**: 发现行尾多余的空格字符

#### 注意事项
- 此设置会应用到所有打开的标签页
- 新建的标签页会继承当前的显示设置
- 显示空白字符不会影响代码的实际内容，只是视觉辅助

### 语法高亮

#### 高亮规则
- **SQL关键字**: 蓝色显示（SELECT, FROM, WHERE等）
- **字符串**: 红色显示（单引号包围的内容）
- **注释**: 绿色显示（--开头的行注释）

#### 支持的关键字
程序支持75+个标准SQL关键字，包括：
- 基本查询: SELECT, FROM, WHERE, ORDER BY
- 数据操作: INSERT, UPDATE, DELETE
- 表操作: CREATE, ALTER, DROP
- 函数和操作符: COUNT, SUM, AVG, MAX, MIN
- 连接: JOIN, LEFT JOIN, RIGHT JOIN, INNER JOIN

## 快捷键参考

### 文件操作
| 功能 | 快捷键 |
|------|--------|
| 新建标签页 | Ctrl+N |
| 打开文件 | Ctrl+O |
| 保存文件 | Ctrl+S |
| 另存为 | Ctrl+Shift+S |
| 关闭标签页 | Ctrl+W |
| 退出程序 | Ctrl+Q |

### 编辑操作
| 功能 | 快捷键 |
|------|--------|
| 撤销 | Ctrl+Z |
| 重做 | Ctrl+Y |
| 查找替换 | Ctrl+H |
| 显示空格和Tab | 菜单选项 |
| 增加缩进（选中多行） | Tab |
| 减少缩进（选中多行） | Shift+Tab |
| 转换为大写（选中文本） | Ctrl+Shift+U |
| 转换为小写（选中文本） | Ctrl+Shift+L |

### 工具功能
| 功能 | 快捷键 |
|------|--------|
| 格式化SQL | Ctrl+F |
| 转换Java格式 | Ctrl+J |
| 从Java转回SQL | Ctrl+K |
| 对齐注释 | Ctrl+L |
| 填充参数 | Ctrl+P |
| 代码填充 | Ctrl+M |

### 帮助
| 功能 | 快捷键 |
|------|--------|
| 关于 | F1 |

## 常见问题

### Q1: 打开文件时出现乱码怎么办？
**A:** 程序会自动检测文件编码，支持UTF-8、GBK、GB18030等常见编码。如果仍有乱码，建议将文件转换为UTF-8编码后再打开。

### Q2: SQL格式化后的结果不符合预期？
**A:** SQL格式化基于sqlparse库，可能对某些复杂SQL语句的处理不够完美。建议：
- 检查SQL语法是否正确
- 对于复杂嵌套查询，可以分段格式化
- 手动调整格式化后的结果

### Q3: Java代码转换时出现错误？
**A:** 确保Java代码格式正确：
- 每行应该是`sb.append("...")`的格式
- 引号内容应该是有效的SQL片段
- 避免复杂的字符串转义

### Q4: 参数填充时提示数量不匹配？
**A:** 检查以下几点：
- 确保`?`占位符数量与输入参数数量一致
- 参数之间用英文逗号分隔
- 避免参数中包含逗号（如需要，请用其他分隔符）

### Q5: 查找替换功能不工作？
**A:** 检查以下设置：
- 确认查找内容不为空
- 检查"区分大小写"选项设置
- 如使用正则表达式，确保语法正确

### Q6: 程序启动失败？
**A:** 可能的原因和解决方案：
- 检查Python版本是否>=3.13
- 确认已安装所有依赖包
- 尝试重新安装PySide6: `pip install --upgrade PySide6`

## 使用技巧

### 1. 提高工作效率
- **善用快捷键**: 熟记常用功能的快捷键
- **模板复用**: 保存常用的代码模板，提高代码生成效率
- **批量处理**: 使用查找替换功能批量修改代码

### 2. SQL开发最佳实践
- **先格式化**: 在编写复杂SQL前，先格式化现有代码
- **参数化查询**: 使用参数填充功能测试SQL语句
- **注释规范**: 使用注释对齐功能保持代码整洁

### 3. Java开发辅助
- **SQL嵌入**: 使用Java转换功能将SQL嵌入到Java代码中
- **代码生成**: 利用模板填充功能生成重复性代码
- **格式统一**: 使用注释对齐功能统一代码风格

### 4. 文件管理
- **编码统一**: 建议统一使用UTF-8编码
- **备份重要文件**: 在进行大量修改前备份原文件
- **版本控制**: 配合Git等版本控制工具使用

### 5. 自定义配置
- **主题调整**: 可以修改源码中的颜色配置
- **字体设置**: 可以更改编辑器字体和大小
- **快捷键**: 可以自定义快捷键组合

## 技术支持

如果您在使用过程中遇到问题，可以：

1. **查看技术文档**: 参考`docs/技术文档.md`了解详细技术信息
2. **联系开发者**: 
   - 邮箱: zhongliang.liu@lixil.com
   - 在代码仓库中提交Issue

## 版本更新

程序会不断改进和完善，建议定期检查更新：
- 关注新功能发布
- 及时更新依赖包
- 备份个人配置和模板

---

**感谢使用SQL编辑器！希望这个工具能够提高您的开发效率。**